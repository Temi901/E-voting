{% extends 'voting/base.html' %}

{% block title %}Dashboard - E-Voting System{% endblock %}

{% block content %}
<style>
    :root {
        --ink: #0d0f14; --surface: #f5f4f0; --card: #ffffff;
        --accent: #1a3c5e; --gold: #c9a84c; --gold-light: #f0d98c;
        --muted: #6b7280; --border: #e2ddd6; --radius: 12px;
        --transition: 0.28s cubic-bezier(.4,0,.2,1);
    }

    .dash-wrap { max-width: 1200px; margin: 0 auto; padding: 0 28px 80px; }

    /* â”€â”€ WELCOME BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .dash-banner {
        background: var(--accent);
        margin: 0 -28px; padding: 48px 28px 52px;
        position: relative; overflow: hidden;
        margin-bottom: -28px;
    }
    .dash-banner-bg {
        position: absolute; inset: 0;
        background:
            radial-gradient(ellipse 60% 80% at 80% 50%, rgba(201,168,76,0.1) 0%, transparent 60%),
            linear-gradient(150deg, #0d1f33 0%, #1a3c5e 100%);
    }
    .dash-banner-bg::after {
        content: '';
        position: absolute; inset: 0;
        background-image: radial-gradient(circle, rgba(255,255,255,0.04) 1px, transparent 1px);
        background-size: 36px 36px;
    }
    .dash-banner-inner {
        position: relative; z-index: 2;
        max-width: 1200px; margin: 0 auto;
        display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;
    }
    .dash-welcome-label {
        font-size: 0.7rem; font-weight: 600; letter-spacing: 0.12em;
        text-transform: uppercase; color: var(--gold); margin-bottom: 6px;
    }
    .dash-welcome-name {
        font-family: 'Playfair Display', serif;
        font-size: 2rem; font-weight: 700; color: #fff;
        letter-spacing: -0.02em; margin-bottom: 8px;
    }
    .dash-voter-id {
        display: inline-flex; align-items: center; gap: 7px;
        padding: 5px 14px; border-radius: 20px;
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.15);
        color: rgba(255,255,255,0.7);
        font-size: 0.82rem; font-weight: 500;
    }
    .dash-voter-id i { color: var(--gold); font-size: 0.72rem; }

    /* â”€â”€ STAT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
        display: grid; grid-template-columns: repeat(3, 1fr);
        gap: 20px; margin-bottom: 40px;
        position: relative; z-index: 2;
        padding-top: 40px;
    }
    .stat-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px; padding: 24px 26px;
        display: flex; align-items: center; gap: 18px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.05);
        transition: all var(--transition);
        animation: cardIn 0.5s cubic-bezier(.4,0,.2,1) both;
    }
    .stat-card:nth-child(2) { animation-delay: 0.07s; }
    .stat-card:nth-child(3) { animation-delay: 0.14s; }
    .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(0,0,0,0.09); }
    .stat-icon-wrap {
        width: 52px; height: 52px; border-radius: 14px; flex-shrink: 0;
        background: linear-gradient(135deg, #e8f0f9 0%, #d4e4f4 100%);
        display: flex; align-items: center; justify-content: center;
        font-size: 1.4rem;
    }
    .stat-num {
        font-family: 'Playfair Display', serif;
        font-size: 2rem; font-weight: 700; color: var(--ink);
        line-height: 1;
    }
    .stat-label { font-size: 0.82rem; color: var(--muted); margin-top: 3px; }

    @keyframes cardIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:none} }

    /* â”€â”€ ELECTIONS SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-hdr {
        display: flex; align-items: center; justify-content: space-between;
        margin-bottom: 24px;
    }
    .section-title-sm {
        font-family: 'Playfair Display', serif;
        font-size: 1.5rem; font-weight: 700; color: var(--ink);
    }
    .section-count {
        font-size: 0.78rem; font-weight: 600; color: var(--muted);
        background: var(--surface); border: 1px solid var(--border);
        padding: 4px 12px; border-radius: 20px;
    }

    .elections-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 22px;
    }

    .el-card {
        background: var(--card);
        border: 1.5px solid var(--border);
        border-radius: 16px; padding: 26px;
        transition: all var(--transition);
        display: flex; flex-direction: column; gap: 16px;
    }
    .el-card:hover {
        border-color: rgba(26,60,94,0.2);
        box-shadow: 0 8px 28px rgba(26,60,94,0.08);
        transform: translateY(-2px);
    }
    .el-card.el-voted { border-color: rgba(16,185,129,0.3); }

    .el-card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
    .el-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.1rem; font-weight: 700; color: var(--ink); line-height: 1.3;
    }

    /* Status badges */
    .badge {
        display: inline-flex; align-items: center; gap: 5px;
        padding: 4px 12px; border-radius: 20px;
        font-size: 0.7rem; font-weight: 600;
        letter-spacing: 0.06em; white-space: nowrap; flex-shrink: 0;
    }
    .badge-active {
        background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.25);
        color: #059669;
    }
    .badge-active::before {
        content: ''; width: 6px; height: 6px; border-radius: 50%;
        background: #10b981; animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
    .badge-voted { background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.25); color: #2563eb; }
    .badge-closed { background: rgba(107,114,128,0.1); border: 1px solid rgba(107,114,128,0.2); color: var(--muted); }

    .el-desc { color: var(--muted); font-size: 0.87rem; line-height: 1.6; }

    .el-dates {
        background: var(--surface); border-radius: 10px;
        padding: 12px 14px; border-left: 3px solid var(--gold);
        display: flex; flex-direction: column; gap: 5px;
    }
    .el-date-row { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--muted); }
    .el-date-row strong { color: var(--ink); min-width: 40px; }

    /* Action areas */
    .el-action { margin-top: auto; }

    .btn-vote {
        display: flex; align-items: center; justify-content: center; gap: 8px;
        width: 100%; padding: 13px;
        border-radius: var(--radius); text-decoration: none;
        font-weight: 600; font-size: 0.9rem;
        transition: all var(--transition);
    }
    .btn-vote-primary {
        background: var(--accent); color: #fff;
        box-shadow: 0 4px 14px rgba(26,60,94,0.2);
    }
    .btn-vote-primary:hover { background: #24527a; transform: translateY(-1px); box-shadow: 0 8px 20px rgba(26,60,94,0.28); }
    .btn-vote-results {
        background: rgba(59,130,246,0.1); color: #2563eb;
        border: 1px solid rgba(59,130,246,0.25);
    }
    .btn-vote-results:hover { background: rgba(59,130,246,0.16); }

    .status-note {
        padding: 12px 14px; border-radius: 10px;
        font-size: 0.82rem; font-weight: 500; text-align: center;
        display: flex; align-items: center; justify-content: center; gap: 7px;
    }
    .note-success { background: rgba(16,185,129,0.08); border: 1px solid rgba(16,185,129,0.2); color: #059669; }
    .note-warning { background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.2); color: #b45309; }
    .note-gray    { background: rgba(107,114,128,0.08); border: 1px solid rgba(107,114,128,0.15); color: var(--muted); }
    .note-danger  { background: rgba(239,68,68,0.07); border: 1px solid rgba(239,68,68,0.2); color: #b91c1c; }
    .note-sub { display: block; font-size: 0.75rem; font-weight: 400; margin-top: 3px; opacity: 0.8; }

    /* Empty state */
    .empty-state {
        text-align: center; padding: 64px 20px;
        background: var(--card); border: 1px solid var(--border);
        border-radius: 16px;
    }
    .empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }
    .empty-state p { color: var(--muted); font-size: 0.95rem; }

    @media (max-width: 900px) {
        .stats-row { grid-template-columns: repeat(2,1fr); }
        .elections-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 600px) {
        .stats-row { grid-template-columns: 1fr; }
        .dash-welcome-name { font-size: 1.6rem; }
    }
</style>

<!-- Banner -->
<div class="dash-banner">
    <div class="dash-banner-bg"></div>
    <div class="dash-banner-inner">
        <div>
            <p class="dash-welcome-label">Voter Dashboard</p>
            <h1 class="dash-welcome-name">Hello, {{ user.first_name }} ğŸ‘‹</h1>
            <span class="dash-voter-id"><i class="fas fa-id-card"></i> ID: {{ voter.voter_id }}</span>
        </div>
    </div>
</div>

<div class="dash-wrap">
    <!-- Stats -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-icon-wrap">ğŸ—³ï¸</div>
            <div>
                <div class="stat-num">{{ elections|length }}</div>
                <div class="stat-label">Active Elections</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon-wrap">âœ…</div>
            <div>
                <div class="stat-num">{{ voted_elections|length }}</div>
                <div class="stat-label">Votes Cast</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon-wrap">ğŸ“Š</div>
            <div>
                <div class="stat-num">{{ elections|length|add:voted_elections|length }}</div>
                <div class="stat-label">Total Participation</div>
            </div>
        </div>
    </div>

    <!-- Elections -->
    <div class="section-hdr">
        <h2 class="section-title-sm">Available Elections</h2>
        <span class="section-count">{{ elections|length }} election{{ elections|length|pluralize }}</span>
    </div>

    {% if elections %}
    <div class="elections-grid">
        {% for election in elections %}
        <div class="el-card {% if election.id in voted_elections %}el-voted{% endif %}">
            <div class="el-card-top">
                <h3 class="el-title">{{ election.title }}</h3>
                {% if election.has_ended %}
                    <span class="badge badge-closed">Closed</span>
                {% elif election.id in voted_elections %}
                    <span class="badge badge-voted">âœ“ Voted</span>
                {% else %}
                    <span class="badge badge-active">Live</span>
                {% endif %}
            </div>

            <p class="el-desc">{{ election.description }}</p>

            <div class="el-dates">
                <div class="el-date-row"><strong>Start</strong> {{ election.start_date|date:"M d, Y H:i" }}</div>
                <div class="el-date-row"><strong>End</strong> {{ election.end_date|date:"M d, Y H:i" }}</div>
            </div>

            <div class="el-action">
                {% if election.id in voted_elections %}
                    {% if election.is_ongoing %}
                        <div class="status-note note-success">
                            âœ… Vote Recorded!
                            <span class="note-sub">Results available 24hrs after election ends</span>
                        </div>
                    {% elif election.results_available_for_24hr %}
                        <a href="{% url 'results' election.id %}" class="btn-vote btn-vote-results">
                            <i class="fas fa-chart-bar"></i> View Final Results
                        </a>
                        <div class="status-note note-warning" style="margin-top:10px;">
                            â° Results expire in {{ election.get_results_expiry_time|timeuntil }}
                        </div>
                    {% else %}
                        <div class="status-note note-gray">
                            ğŸ”’ Results Window Closed
                            <span class="note-sub">24-hour viewing period has expired</span>
                        </div>
                    {% endif %}
                {% else %}
                    {% if election.is_ongoing %}
                        <a href="{% url 'vote' election.id %}" class="btn-vote btn-vote-primary">
                            <i class="fas fa-vote-yea"></i> Cast Your Vote
                        </a>
                    {% elif election.has_ended and election.results_available_for_24hr %}
                        <div class="status-note note-danger">
                            âš ï¸ You must have voted to view results
                        </div>
                    {% else %}
                        <div class="status-note note-gray">ğŸ”’ Election Closed</div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ğŸ“­</div>
        <p>No active elections at the moment. Check back later!</p>
    </div>
    {% endif %}
</div>
{% endblock %}